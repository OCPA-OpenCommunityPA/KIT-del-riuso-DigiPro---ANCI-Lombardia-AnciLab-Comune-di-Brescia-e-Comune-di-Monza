<definitions id="Definition"
				 targetNamespace="http://www.omg.org/bpmn20"
				 typeLanguage="http://www.java.com/javaTypes"
				 expressionLanguage="http://www.mvel.org/2.0"
				 xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
				 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
				 xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd"
				 xmlns:g="http://www.jboss.org/drools/flow/gpd"
				 xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
				 xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
				 xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
				 xmlns:tns="http://www.jboss.org/drools">

    <itemDefinition id="booleanType" structureRef="java.lang.Boolean"/>

    <itemDefinition id="numberType" structureRef="java.lang.Number"/>
    <itemDefinition id="integerType" structureRef="java.lang.Number"/>

    <itemDefinition id="textType" structureRef="java.lang.String"/>
    <itemDefinition id="textRefType" structureRef="java.lang.String"/>
    <itemDefinition id="scriptType" structureRef="java.lang.String"/>
    <itemDefinition id="actorType" structureRef="java.lang.String"/>
    <itemDefinition id="actoridType" structureRef="java.lang.String"/>
    <itemDefinition id="fileType" structureRef="java.lang.String"/>
    <itemDefinition id="userTokenType" structureRef="java.lang.String"/>
    <itemDefinition id="htmlType" structureRef="java.lang.String"/>
    <itemDefinition id="noteType" structureRef="java.lang.String"/>
    <itemDefinition id="multiInstanceItemType" structureRef="java.lang.String" />
    <itemDefinition id="datetimeType" structureRef="java.lang.String"/>
    <itemDefinition id="timeSpanType" structureRef="java.lang.String"/>
    <itemDefinition id="deadlineType" structureRef="java.lang.String"/>
    <itemDefinition id="diagramType" structureRef="java.lang.String"/>

    <itemDefinition id="objectType" structureRef="java.util.HashMap"/>
    <itemDefinition id="entityType" structureRef="java.util.HashMap"/>
    <itemDefinition id="documentType" structureRef="java.util.HashMap"/>
    <itemDefinition id="fascicoloType" structureRef="java.util.HashMap"/>
    <itemDefinition id="mittenteType" structureRef="java.util.HashMap"/>
    <itemDefinition id="communicationType" structureRef="java.util.HashMap"/>
    <itemDefinition id="laneType" structureRef="java.util.HashMap"/>
    <itemDefinition id="systemType" structureRef="java.util.HashMap"/>
    <itemDefinition id="soggettoType" structureRef="java.util.HashMap"/>
    <itemDefinition id="classificaType" structureRef="java.util.HashMap"/>
    <itemDefinition id="registroType" structureRef="java.util.HashMap"/>
    <itemDefinition id="uoType" structureRef="java.util.HashMap"/>
    <itemDefinition id="roleType" structureRef="java.util.HashMap"/>
    <itemDefinition id="MessageType" structureRef="java.util.HashMap"/>

    <itemDefinition id="tempType" structureRef="java.lang.Object"/>

    <itemDefinition id="collectionType" structureRef="java.util.List"/>
    <itemDefinition id="_listItem" structureRef="java.util.List" />

    <message id="defaultMessage" itemRef="MessageType" />
    <error id="cancel" errorCode="cancel" />
    <error id="bpmn2.WorkflowException" errorCode="bpmn2.WorkflowException" />
    <error id="anyException" />
    <error id="bpmn2.ServiceException" errorCode="bpmn2.ServiceException" />
    <error id="bpmn2.SendException" errorCode="bpmn2.SendException" />

    <interface id="EAID_B73BF5BB_A892_460d_B3BA_5D8873850689" name="Interface1">
        <operation id="swaggerOperation" name="swaggerOperation">
            <inMessageRef>defaultMessage</inMessageRef>
        </operation>
    </interface>

    <process processType="Private" tns:version="1.0" isExecutable="true" id="Integrazione protocollo JEnte1.0" name="Integrazione protocollo JEnte" tns:packageName="Orchestratore">
        <property id="formatoDataProtocollo" itemSubjectRef="textType"/>
        <property id="messaggioProtoPartenza" itemSubjectRef="textType"/>
        <property id="_tmpc_" itemSubjectRef="collectionType"/>
        <property id="docDaProtocollare" itemSubjectRef="objectType"/>
        <property id="dataProtocollo" itemSubjectRef="textType"/>
        <property id="riferimentoProto" itemSubjectRef="objectType"/>
        <property id="INSTANCE_AOO" itemSubjectRef="textType"/>
        <property id="humanToken" itemSubjectRef="userTokenType"/>
        <property id="timeZoneDataProtocollo" itemSubjectRef="textType"/>
        <property id="_tmp1_" itemSubjectRef="tempType"/>
        <property id="$state" itemSubjectRef="integerType"/>
        <property id="oggettoProto" itemSubjectRef="textType"/>
        <property id="lanes" itemSubjectRef="collectionType"/>
        <property id="host" itemSubjectRef="textType"/>
        <property id="numeroProtocollo" itemSubjectRef="textType"/>
        <property id="UO" itemSubjectRef="objectType"/>
        <property id="destinatario_cittadino" itemSubjectRef="objectType"/>
        <property id="$" itemSubjectRef="objectType"/>
        <property id="test" itemSubjectRef="textType"/>
        <property id="protocollaPartenza" itemSubjectRef="objectType"/>
        <property id="history" itemSubjectRef="objectType"/>
        <property id="_tmp0_" itemSubjectRef="tempType"/>
        <property id="tipoRichiesta" itemSubjectRef="textType"/>
        <property id="pathDocDaProtocollare" itemSubjectRef="textType"/>
        <property id="localhost_8082" itemSubjectRef="textType"/>
        <property id="xml_dest_interno" itemSubjectRef="textType"/>
        <property id="registroProtocollo" itemSubjectRef="textType"/>
        <property id="esitoProtoPartenza" itemSubjectRef="textType"/>
        <property id="xml_mitt_esterno" itemSubjectRef="textType"/>
        <property id="instanceId" itemSubjectRef="textRefType"/>
        <property id="responseProtoPartenza" itemSubjectRef="objectType"/>
        <property id="businessState" itemSubjectRef="textType"/>
        <property id="INSTANCE_ENTE" itemSubjectRef="textType"/>
        <property id="outcome" itemSubjectRef="objectType"/>
        <property id="xml_mitt_interno" itemSubjectRef="textType"/>
        <property id="contextKey" itemSubjectRef="textType"/>
        <property id="documentoPrincipale" itemSubjectRef="objectType"/>
        <property id="allegatiDaProtocollare" itemSubjectRef="collectionType"/>
        <property id="systemToken" itemSubjectRef="userTokenType"/>
        <property id="xml_dest_esterno" itemSubjectRef="textType"/>
        <property id="descrizione" itemSubjectRef="textType"/>
        <property id="__ckValue" itemSubjectRef="collectionType"/>
        <property id="UO_RESP" itemSubjectRef="objectType"/>
        <property id="_tmp2_" itemSubjectRef="tempType"/>
        <property id="xml_destinatari" itemSubjectRef="textType"/>
        <property id="Administrators" itemSubjectRef="objectType"/>
        <property id="xml_mittenti" itemSubjectRef="textType"/>
        <property id="username" itemSubjectRef="textType"/>
        <property id="__tmp__" itemSubjectRef="tempType"/>
        <property id="_tmpevt_" itemSubjectRef="objectType"/>
        <property id="$" itemSubjectRef="objectType"/>
        <property id="_foreachc_" itemSubjectRef="collectionType"/>
        <property id="_foreachi_" itemSubjectRef="objectType"/>

<!-- **************************** INIZIO SUBPROCESS block30 ****************************** -->

<subProcess id="block30" isForCompensation="false" name="Allega documenti al Protocollo"  triggeredByEvent="false">

    <property id="contextKey" itemSubjectRef="textType"/>
    <property id="currentEsito" itemSubjectRef="textType"/>
    <property id="_tmp1_" itemSubjectRef="tempType"/>
    <property id="_tmp0_" itemSubjectRef="tempType"/>
    <property id="docProto" itemSubjectRef="objectType"/>
    <property id="_tmpc_" itemSubjectRef="collectionType"/>
    <property id="_tmp2_" itemSubjectRef="tempType"/>
    <property id="currentDocument" itemSubjectRef="objectType"/>
    <property id="currentMessaggio" itemSubjectRef="textType"/>
    <property id="currentPath" itemSubjectRef="textType"/>
    <property id="humanToken" itemSubjectRef="userTokenType"/>

<extensionElements>
        <tns:onEntry-script scriptFormat="http://www.mvel.org/2.0" >
            <tns:script><![CDATA[
            
            
            
//[auto-insert]
kcontext.setVariable("_tmpc_",null);
kcontext.setVariable("_tmpc_",[]);
kcontext.setVariable("currentDocument",null);
kcontext.setVariable("currentDocument",{"@structure":"document","DOCNAME":"","TYPE_ID":"DOCUMENTO","ABSTRACT":"currentDocument","TIPO_PROTOCOLLAZIONE":""});
kcontext.setVariable("docProto",null);
kcontext.setVariable("docProto",{});

                ]]></tns:script>
        </tns:onEntry-script>
</extensionElements>
<ioSpecification>

    <dataInput id="block30_CollectionExpressionInput" name="CollectionExpression" />
    <dataOutput id="block30_OutputCollectionExpressionOutput" name="OutputCollectionExpression" />

    <inputSet>
        <dataInputRefs>block30_CollectionExpressionInput</dataInputRefs>
    </inputSet>

    <outputSet>
        <dataOutputRefs>block30_OutputCollectionExpressionOutput</dataOutputRefs>
    </outputSet>

</ioSpecification>

<dataInputAssociation>
    <sourceRef>allegatiDaProtocollare</sourceRef>
    <targetRef>block30_CollectionExpressionInput</targetRef>
</dataInputAssociation>

<dataOutputAssociation>
    <sourceRef>block30_OutputCollectionExpressionOutput</sourceRef>
    <targetRef>_foreachc_</targetRef>
</dataOutputAssociation>


<multiInstanceLoopCharacteristics >
    <loopDataInputRef>block30_CollectionExpressionInput</loopDataInputRef>
    <loopDataOutputRef>block30_OutputCollectionExpressionOutput</loopDataOutputRef>
    <inputDataItem id="currentDocument" itemSubjectRef="tempType"/>
    <outputDataItem id="_foreachi_" itemSubjectRef="tempType"/>
</multiInstanceLoopCharacteristics>


<!-- ********************************************************************* -->
<!-- START NEW EXPORT serviceTask -->
<!-- ********************************************************************* -->
<serviceTask id="block30_block2" operationRef="swaggerOperation" isForCompensation="false" name="allegaDocumento" >
<!-- ioSpecification -->
<ioSpecification>
    <dataInput id="block30_block2_riferimentoInput" name="riferimento" />
    <dataInput id="block30_block2_documentoInput" name="documento" />
    <dataInput id="block30_block2_BodyInput" name="Body" />
    <dataInput id="block30_block2_usernameInput" name="username" />
    <dataInput id="block30_block2_retryDelayInput" name="retryDelay" />
    <dataInput id="block30_block2_restUrlInput" name="restUrl" />
    <dataInput id="block30_block2_srvTimeoutInput" name="srvTimeout" />
    <dataInput id="block30_block2_acceptedStatusInput" name="acceptedStatus" />
    <dataInput id="block30_block2_nameInput" name="name" />
    <dataInput id="block30_block2_hostInput" name="host" />
    <dataInput id="block30_block2_commitInput" name="commit" />
    <dataInput id="block30_block2_httpMethodInput" name="httpMethod" />
    <dataInput id="block30_block2_contentTypeInput" name="contentType" />
    <dataInput id="block30_block2_callTypeInput" name="callType" />
    <dataInput id="block30_block2_apiDocInput" name="apiDoc" />
    <dataOutput id="block30_block2_esitoOutput" name="esito" />
    <dataOutput id="block30_block2_messaggioOutput" name="messaggio" />
    <dataOutput id="block30_block2_httpStatusOutput" name="httpStatus" />
    <dataOutput id="block30_block2_ResultOutput" name="Result" />

    <inputSet>
        <dataInputRefs>block30_block2_riferimentoInput</dataInputRefs>
        <dataInputRefs>block30_block2_documentoInput</dataInputRefs>
        <dataInputRefs>block30_block2_BodyInput</dataInputRefs>
        <dataInputRefs>block30_block2_usernameInput</dataInputRefs>
        <dataInputRefs>block30_block2_retryDelayInput</dataInputRefs>
        <dataInputRefs>block30_block2_restUrlInput</dataInputRefs>
        <dataInputRefs>block30_block2_srvTimeoutInput</dataInputRefs>
        <dataInputRefs>block30_block2_acceptedStatusInput</dataInputRefs>
        <dataInputRefs>block30_block2_nameInput</dataInputRefs>
        <dataInputRefs>block30_block2_hostInput</dataInputRefs>
        <dataInputRefs>block30_block2_commitInput</dataInputRefs>
        <dataInputRefs>block30_block2_httpMethodInput</dataInputRefs>
        <dataInputRefs>block30_block2_contentTypeInput</dataInputRefs>
        <dataInputRefs>block30_block2_callTypeInput</dataInputRefs>
        <dataInputRefs>block30_block2_apiDocInput</dataInputRefs>
    </inputSet>

    <outputSet>
        <dataOutputRefs>block30_block2_esitoOutput</dataOutputRefs>
        <dataOutputRefs>block30_block2_messaggioOutput</dataOutputRefs>
        <dataOutputRefs>block30_block2_httpStatusOutput</dataOutputRefs>
        <dataOutputRefs>block30_block2_ResultOutput</dataOutputRefs>
    </outputSet>
</ioSpecification>

<!-- lista inputs -->
<dataInputAssociation><!-- k:riferimento var type: tempRef -->
        <sourceRef><![CDATA[riferimentoProto]]></sourceRef>
        <targetRef>block30_block2_riferimentoInput</targetRef>
</dataInputAssociation>
<dataInputAssociation><!-- k:documento var type: tempRef -->
        <sourceRef><![CDATA[docProto]]></sourceRef>
        <targetRef>block30_block2_documentoInput</targetRef>
</dataInputAssociation>
<dataInputAssociation><!-- k:Body var type: objectRef -->
        <sourceRef><![CDATA[]]></sourceRef>
        <targetRef>block30_block2_BodyInput</targetRef>
</dataInputAssociation>
<dataInputAssociation><!-- k:username var type: textRef -->
        <sourceRef><![CDATA[username]]></sourceRef>
        <targetRef>block30_block2_usernameInput</targetRef>
</dataInputAssociation>

<!-- lista props -->
<dataInputAssociation><!-- var type: string -->
        <targetRef>block30_block2_retryDelayInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[]]></from>
            <to xsi:type="tFormalExpression">block30_block2_retryDelayInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: readOnly -->
        <targetRef>block30_block2_restUrlInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[/jEnte/JProtocolloServices#allegaDocumento]]></from>
            <to xsi:type="tFormalExpression">block30_block2_restUrlInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: integer -->
        <sourceRef><![CDATA[15000]]></sourceRef>
        <targetRef>block30_block2_srvTimeoutInput</targetRef>
</dataInputAssociation>
<dataInputAssociation><!-- var type: text -->
        <targetRef>block30_block2_acceptedStatusInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[200-299]]></from>
            <to xsi:type="tFormalExpression">block30_block2_acceptedStatusInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: text -->
        <targetRef>block30_block2_nameInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[allegaDocumento]]></from>
            <to xsi:type="tFormalExpression">block30_block2_nameInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: textRef -->
        <sourceRef><![CDATA[host]]></sourceRef>
        <targetRef>block30_block2_hostInput</targetRef>
</dataInputAssociation>
<dataInputAssociation><!-- var type: boolean -->
        <sourceRef>false</sourceRef>
        <targetRef>block30_block2_commitInput</targetRef>
</dataInputAssociation>
<dataInputAssociation><!-- var type: readOnly -->
        <targetRef>block30_block2_httpMethodInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[post]]></from>
            <to xsi:type="tFormalExpression">block30_block2_httpMethodInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: enum -->
        <targetRef>block30_block2_contentTypeInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[]]></from>
            <to xsi:type="tFormalExpression">block30_block2_contentTypeInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: enum -->
        <targetRef>block30_block2_callTypeInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[delayed]]></from>
            <to xsi:type="tFormalExpression">block30_block2_callTypeInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: readOnly -->
        <targetRef>block30_block2_apiDocInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[{"swagger":"2.0","info":{"title":"JProtocolloServicesService"},"host":"localhost:8082","basePath":"/jEnte/JProtocolloServices","schemes":["http"],"paths":{"#allegaDocumento":{"post":{"tags":["SOAP","SOAP11"],"summary":"allegaDocumento","operationId":"","consumes":["text/xml; charset=utf-8"],"parameters":[{"in":"body","required":false,"schema":{"required":["documento","riferimento","username"],"properties":{"username":{"type":"string","title":"username"},"riferimento":{"type":"object","title":"riferimento","properties":{"registro":{"type":"object","title":"registro","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"anno":{"type":"string","title":"anno"},"numero":{"type":"string","title":"numero"}},"required":["anno","numero","registro"]},"documento":{"type":"object","title":"documento","properties":{"titolo":{"type":"string","title":"titolo"},"volume":{"type":"object","title":"volume","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"formato":{"type":"object","title":"formato","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"nomeFile":{"type":"string","title":"nomeFile"},"file":{"type":"string","format":"byte","title":"file"}},"required":["file","nomeFile","titolo"]}},"title":"parameters","xml":{"name":"allegaDocumento/richiesta","namespace":"http://webservices.jprotocollo.jente.infor.arezzo.it/","prefix":"web"},"x-namespaces":"xmlns:soapEnv=http://schemas.xmlsoap.org/soap/envelope/"}}],"responses":{"200":{"schema":{"type":"object","title":"parameters","properties":{"esito":{"type":"string","title":"esito"},"messaggio":{"type":"string","title":"messaggio"}},"required":["esito","messaggio"]}},"500":{"description":"Soap Generic Fault","schema":{"type":"object","properties":{"faultcode":{"type":"string"},"faultstring":{"type":"string"},"faultfactor":{"type":"string"}}}}}}}}}]]></from>
            <to xsi:type="tFormalExpression">block30_block2_apiDocInput</to>
        </assignment>
</dataInputAssociation>

<!-- lista outputs -->
<dataOutputAssociation>
        <sourceRef>block30_block2_esitoOutput</sourceRef>
        <targetRef>currentEsito</targetRef>
</dataOutputAssociation>
<dataOutputAssociation>
        <sourceRef>block30_block2_messaggioOutput</sourceRef>
        <targetRef>currentMessaggio</targetRef>
</dataOutputAssociation>
<dataOutputAssociation>
        <sourceRef>block30_block2_httpStatusOutput</sourceRef>
        <targetRef></targetRef>
</dataOutputAssociation>
<dataOutputAssociation>
        <sourceRef>block30_block2_ResultOutput</sourceRef>
        <targetRef></targetRef>
</dataOutputAssociation>
</serviceTask>


<!-- ********************************************************************* -->
<sequenceFlow id="con_923" sourceRef="block30_block2" targetRef="block30_block9">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_905" sourceRef="block30_block8" targetRef="block30_block6">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<scriptTask id="block30_block10" scriptFormat="http://www.mvel.org/2.0" name="Gestione documento da allegare al protocollo" isForCompensation="false" >
    <script>
        <![CDATA[



/************** start user script ***************/

String pathUri = String.valueOf(currentPath);
System.out.println("pathUri "+pathUri);
String characters="getfile/";
String characters2="getFile/";

String newPath = "";
if(pathUri.contains("/getfile/")){
            newPath=pathUri.substring(pathUri.lastIndexOf("/getfile/"),pathUri.length());
            newPath=newPath.replace("/getfile","");
            }
if(pathUri.contains("/getFile/")){
				newPath=pathUri.substring(pathUri.lastIndexOf("/getFile/"),pathUri.length());
            newPath=newPath.replace("/getFile","");
            } 
System.out.println("newPath "+newPath);
java.io.File originalFile = new java.io.File(newPath);
java.io.InputStream fileInputStreamReader = new java.io.FileInputStream(originalFile);

System.out.println("fileInputStreamReaderfileInputStreamReader "+fileInputStreamReader.toString());
//byte[] bytes = new byte[(int)originalFile.length()];
byte[] bytes = org.apache.commons.io.IOUtils.toByteArray(fileInputStreamReader);

System.out.println("encodedBase64");
String encodedBase64 = javax.xml.bind.DatatypeConverter.printBase64Binary(bytes).toString();
System.out.println("encodedBase64encodedBase64 "+encodedBase64);

docProto=new java.util.HashMap();
docProto.file=encodedBase64;
docProto.nomeFile=currentDocument.DOCNAME;
docProto.titolo=currentDocument.DOCNAME;

riferimento=new java.util.HashMap();


/**************  end user script  ***************/

//[auto-insert]
//docProto, docProto, docProto, docProto, riferimento
kcontext.setVariable("docProto",null);
kcontext.setVariable("docProto",docProto);
kcontext.setVariable("docProto",null);
kcontext.setVariable("docProto",docProto);
kcontext.setVariable("docProto",null);
kcontext.setVariable("docProto",docProto);
kcontext.setVariable("docProto",null);
kcontext.setVariable("docProto",docProto);
kcontext.setVariable("riferimento",null);
kcontext.setVariable("riferimento",riferimento);



        ]]>
    </script>
</scriptTask>



<sequenceFlow id="con_935" sourceRef="block30_block11" targetRef="block30_block10">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<task id="block30_block11" name="Recupera profilo allegato da inserire nel protocollo" tns:taskName="DocerJMS" >
    <ioSpecification>

        <dataInput id="block30_block11_TaskNameInput" name="TaskName" />
        <dataInput id="block30_block11_GroupIdInput" name="GroupId" />
        <dataInput id="block30_block11_Operation" name="operation" />
        <dataInput id="block30_block11_ForceDownloadDocument" name="forceDownloadDocument" />

            <dataInput id="block30_block11_userTokenInput" name="userToken" />
            <dataInput id="block30_block11_documentInput" name="document" />
        
            <dataOutput id="block30_block11_userTokenOutput" name="userToken" />
            <dataOutput id="block30_block11_allegatiOutput" name="allegati" />
            <dataOutput id="block30_block11_documentOutput" name="document" />
            <dataOutput id="block30_block11_filePathOutput" name="filePath" />
           

        <inputSet>
            <dataInputRefs>block30_block11_TaskNameInput</dataInputRefs>
            <dataInputRefs>block30_block11_GroupIdInput</dataInputRefs>
            <dataInputRefs>block30_block11_ForceDownloadDocument</dataInputRefs>
            <dataInputRefs>block30_block11_Operation</dataInputRefs>
                <dataInputRefs>block30_block11_userTokenInput</dataInputRefs>
                <dataInputRefs>block30_block11_documentInput</dataInputRefs>
        </inputSet>
        
        <outputSet>
                <dataOutputRefs>block30_block11_userTokenOutput</dataOutputRefs>
                <dataOutputRefs>block30_block11_allegatiOutput</dataOutputRefs>
                <dataOutputRefs>block30_block11_documentOutput</dataOutputRefs>
                <dataOutputRefs>block30_block11_filePathOutput</dataOutputRefs>
                
         </outputSet>

    </ioSpecification>
                <dataInputAssociation>
                            <sourceRef>systemToken</sourceRef>
                            <targetRef>block30_block11_userTokenInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>currentDocument</sourceRef>
                            <targetRef>block30_block11_documentInput</targetRef>

                </dataInputAssociation>
				<dataInputAssociation>
			        <targetRef>block30_block11_ForceDownloadDocument</targetRef>
			        <assignment>
			            <from xsi:type="tFormalExpression">true</from>
			            <to xsi:type="tFormalExpression">block30_block11_ForceDownloadDocument</to>
			        </assignment>
			    </dataInputAssociation>
      <dataInputAssociation>
        <targetRef>block30_block11_GroupIdInput</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression"></from>
           <to xsi:type="tFormalExpression">block30_block11_GroupIdInput</to>
        </assignment>
      </dataInputAssociation>
      <dataInputAssociation>
        <targetRef>block30_block11_TaskNameInput</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression">Recupera profilo allegato da inserire nel protocollo</from>
           <to xsi:type="tFormalExpression">block30_block11_TaskNameInput</to>
        </assignment>
      </dataInputAssociation>
	  <dataInputAssociation>
        <targetRef>block30_block11_Operation</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression">RecuperaProfiloDocumento</from>
           <to xsi:type="tFormalExpression">block30_block11_Operation</to>
        </assignment>
      </dataInputAssociation>

            <dataOutputAssociation>
                            <sourceRef>block30_block11_userTokenOutput</sourceRef>
                            <targetRef>systemToken</targetRef>
                            
            </dataOutputAssociation>
            <dataOutputAssociation>
                            <sourceRef>block30_block11_allegatiOutput</sourceRef>
                            <targetRef></targetRef>
            </dataOutputAssociation>
            <dataOutputAssociation>
                            <sourceRef>block30_block11_documentOutput</sourceRef>
                            <targetRef>currentDocument</targetRef>
            </dataOutputAssociation>
            <dataOutputAssociation>
                            <sourceRef>block30_block11_filePathOutput</sourceRef>
                            <targetRef>currentPath</targetRef>
                            
            </dataOutputAssociation>
           
      <potentialOwner>
        <resourceAssignmentExpression>
           <formalExpression></formalExpression>
        </resourceAssignmentExpression>
      </potentialOwner>
</task>

<endEvent id="block30_block1" name="end (none)">

</endEvent>

<exclusiveGateway id="block30_block5" name="Exclusive Join (XOR)" gatewayDirection="Converging"></exclusiveGateway>

<exclusiveGateway id="block30_block7" name="Exclusive Split (XOR)" gatewayDirection="Diverging"></exclusiveGateway>

<sequenceFlow id="con_917" sourceRef="block30_block7" targetRef="block30_block2">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[test!="si"]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_947" sourceRef="block30_block10" targetRef="block30_block5">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_899" sourceRef="block30_block7" targetRef="block30_block8">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[test=="si"]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_911" sourceRef="block30_block9" targetRef="block30_block8">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_887" sourceRef="block30_block4" targetRef="block30_block5">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_941" sourceRef="block30_block0" targetRef="block30_block11">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<exclusiveGateway id="block30_block8" name="Exclusive Join (XOR)" gatewayDirection="Converging"></exclusiveGateway>

<task id="block30_block9" name="Commit" tns:taskName="DocerJMS" >
    <ioSpecification>

        <dataInput id="block30_block9_TaskNameInput" name="TaskName" />
        <dataInput id="block30_block9_Operation" name="operation" />
        <inputSet>
            <dataInputRefs>block30_block9_TaskNameInput</dataInputRefs>
            <dataInputRefs>block30_block9_Operation</dataInputRefs>
        </inputSet>

        <outputSet>

        </outputSet>

    </ioSpecification>
    <dataInputAssociation>
        <targetRef>block30_block9_TaskNameInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression">Commit</from>
            <to xsi:type="tFormalExpression">block30_block9_TaskNameInput</to>
        </assignment>
    </dataInputAssociation>
    <dataInputAssociation>
        <targetRef>block30_block9_Operation</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression">Dummy</from>
            <to xsi:type="tFormalExpression">block30_block9_Operation</to>
        </assignment>
    </dataInputAssociation>

</task>

<sequenceFlow id="con_929" sourceRef="block30_block6" targetRef="block30_block1">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[currentEsito=="OK"]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_893" sourceRef="block30_block5" targetRef="block30_block7">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_881" sourceRef="block30_block6" targetRef="block30_block4">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[currentEsito!="OK"]]>
    </conditionExpression>
</sequenceFlow>

<userTask id="block30_block4" name="Old HT_block30_block4" >


    <ioSpecification>

        <dataInput id="block30_block4_TaskNameInput" name="TaskName" />
        <dataInput id="block30_block4_GroupIdInput" name="GroupId" />
        <dataInput id="block30_block4_SwimlaneActorIdInput" name="SwimlaneActorId" />

            <dataInput id="block30_block4_commentInput" name="comment" />
            <dataInput id="block30_block4_currentMessaggioInput" name="currentMessaggio" />
        
            <dataOutput id="block30_block4_reasonOutput" name="reason" />
            <dataOutput id="block30_block4_userTokenOutput" name="userToken" />
           

        <inputSet>
            <dataInputRefs>block30_block4_SwimlaneActorIdInput</dataInputRefs>
            <dataInputRefs>block30_block4_TaskNameInput</dataInputRefs>
            <dataInputRefs>block30_block4_GroupIdInput</dataInputRefs>
                <dataInputRefs>block30_block4_commentInput</dataInputRefs>
                <dataInputRefs>block30_block4_currentMessaggioInput</dataInputRefs>
        </inputSet>
        
        <outputSet>
                <dataOutputRefs>block30_block4_reasonOutput</dataOutputRefs>
                <dataOutputRefs>block30_block4_userTokenOutput</dataOutputRefs>
                
         </outputSet>

    </ioSpecification>
                <dataInputAssociation>
                                <targetRef>block30_block4_commentInput</targetRef>
                                <assignment>
                                <from xsi:type="tFormalExpression"><![CDATA[]]></from>
                                <to xsi:type="tFormalExpression">block30_block4_commentInput</to>
                                </assignment>

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>currentMessaggio</sourceRef>
                            <targetRef>block30_block4_currentMessaggioInput</targetRef>
                            

                </dataInputAssociation>

      <dataInputAssociation>
          <sourceRef>UO.identity</sourceRef>
          <targetRef>block30_block4_GroupIdInput</targetRef>
      </dataInputAssociation>
      <dataInputAssociation>
        <targetRef>block30_block4_TaskNameInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression">"Gestione errore di allega documento per protocollo"</from>
           <to xsi:type="tFormalExpression">block30_block4_TaskNameInput</to>
        </assignment>
      </dataInputAssociation>
            <dataOutputAssociation>
                    <sourceRef>block30_block4_reasonOutput</sourceRef>
                    <targetRef></targetRef>
            </dataOutputAssociation>
            <dataOutputAssociation>
                    <sourceRef>block30_block4_userTokenOutput</sourceRef>
                    <targetRef>humanToken</targetRef>
            </dataOutputAssociation>
           
      <potentialOwner>
        <resourceAssignmentExpression>
           <formalExpression></formalExpression>
        </resourceAssignmentExpression>
      </potentialOwner>
</userTask>

<exclusiveGateway id="block30_block6" name="Exclusive Split (XOR)" gatewayDirection="Diverging"></exclusiveGateway>

<!-- id:block30_block0 -->
<startEvent id="block30_block0" name="start (none)" isInterrupting="false" >
    <dataOutput id="block30_block0_Output" name="object" />

    <outputSet>
        <dataOutputRefs>block30_block0_Output</dataOutputRefs>
    </outputSet>

    <dataOutputAssociation>
        <sourceRef>block30_block0_Output</sourceRef>
        <targetRef>_tmpevt_</targetRef>
    </dataOutputAssociation>

</startEvent>


</subProcess>
<!-- **************************** FINE SUBPROCESS ****************************** -->



<sequenceFlow id="con_2087" sourceRef="block22" targetRef="block26">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_2051" sourceRef="block18" targetRef="block17">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_2081" sourceRef="block19" targetRef="block22">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_2123" sourceRef="block27" targetRef="block31">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_2057" sourceRef="block13" targetRef="block18">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_2045" sourceRef="block15" targetRef="block13">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<task id="block33" name="Recupera UD" tns:taskName="DocerJMS" >
    <ioSpecification>

        <dataInput id="block33_TaskNameInput" name="TaskName" />
        <dataInput id="block33_GroupIdInput" name="GroupId" />
        <dataInput id="block33_Operation" name="operation" />

            <dataInput id="block33_userTokenInput" name="userToken" />
            <dataInput id="block33_documentInput" name="document" />
        
            <dataOutput id="block33_userTokenOutput" name="userToken" />
            <dataOutput id="block33_annessiOutput" name="annessi" />
            <dataOutput id="block33_annotazioniOutput" name="annotazioni" />
            <dataOutput id="block33_allegatiOutput" name="allegati" />
            <dataOutput id="block33_documentOutput" name="document" />
           

        <inputSet>
            <dataInputRefs>block33_TaskNameInput</dataInputRefs>
            <dataInputRefs>block33_GroupIdInput</dataInputRefs>
            <dataInputRefs>block33_Operation</dataInputRefs>
                <dataInputRefs>block33_userTokenInput</dataInputRefs>
                <dataInputRefs>block33_documentInput</dataInputRefs>
        </inputSet>
        
        <outputSet>
                <dataOutputRefs>block33_userTokenOutput</dataOutputRefs>
                <dataOutputRefs>block33_annessiOutput</dataOutputRefs>
                <dataOutputRefs>block33_annotazioniOutput</dataOutputRefs>
                <dataOutputRefs>block33_allegatiOutput</dataOutputRefs>
                <dataOutputRefs>block33_documentOutput</dataOutputRefs>
                
         </outputSet>

    </ioSpecification>
                <dataInputAssociation>
                            <sourceRef>systemToken</sourceRef>
                            <targetRef>block33_userTokenInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>docDaProtocollare</sourceRef>
                            <targetRef>block33_documentInput</targetRef>

                </dataInputAssociation>

      <dataInputAssociation>
        <targetRef>block33_GroupIdInput</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression"></from>
           <to xsi:type="tFormalExpression">block33_GroupIdInput</to>
        </assignment>
      </dataInputAssociation>
      <dataInputAssociation>
        <targetRef>block33_TaskNameInput</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression">Recupera UD</from>
           <to xsi:type="tFormalExpression">block33_TaskNameInput</to>
        </assignment>
      </dataInputAssociation>
	  <dataInputAssociation>
        <targetRef>block33_Operation</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression">RecuperaUnitaDocumentaria</from>
           <to xsi:type="tFormalExpression">block33_Operation</to>
        </assignment>
      </dataInputAssociation>

            <dataOutputAssociation>
                            <sourceRef>block33_userTokenOutput</sourceRef>
                            <targetRef>systemToken</targetRef>
                            
            </dataOutputAssociation>
            <dataOutputAssociation>
                            <sourceRef>block33_annessiOutput</sourceRef>
                            <targetRef></targetRef>
            </dataOutputAssociation>
            <dataOutputAssociation>
                            <sourceRef>block33_annotazioniOutput</sourceRef>
                            <targetRef></targetRef>
            </dataOutputAssociation>
            <dataOutputAssociation>
                            <sourceRef>block33_allegatiOutput</sourceRef>
                            <targetRef>allegatiDaProtocollare</targetRef>
            </dataOutputAssociation>
            <dataOutputAssociation>
                            <sourceRef>block33_documentOutput</sourceRef>
                            <targetRef>docDaProtocollare</targetRef>
            </dataOutputAssociation>
           
      <potentialOwner>
        <resourceAssignmentExpression>
           <formalExpression></formalExpression>
        </resourceAssignmentExpression>
      </potentialOwner>
</task>

<exclusiveGateway id="block11" name="Exclusive Join (XOR)" gatewayDirection="Converging"></exclusiveGateway>

<sequenceFlow id="con_2147" sourceRef="block11" targetRef="block32">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_2027" sourceRef="block12" targetRef="block10">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[esitoProtoPartenza!="OK"]]>
    </conditionExpression>
</sequenceFlow>

<endEvent id="block1" name="end (none)">

</endEvent>

<scriptTask id="block28" scriptFormat="http://www.mvel.org/2.0" name="Set mittente interno-destinatario esterno-altri dati di protocollo" isForCompensation="false" >
    <script>
        <![CDATA[



/************** start user script ***************/


xml_mittenti=xml_mitt_interno;
sub = new org.apache.commons.lang3.text.StrSubstitutor(destinatario_cittadino);
xml_destinatari = sub.replace(xml_dest_esterno);

System.out.println("xml_mittenti "+xml_mittenti);
System.out.println("xml_destinatari "+xml_destinatari);

numeroProtocollo=responseProtoPartenza.get("numero");
System.out.println("numeroProtocollo "+numeroProtocollo);

if(responseProtoPartenza.get("registro")!=null){
   registroProtocollo=responseProtoPartenza.get("registro").get("codice"); 
}
System.out.println("registroProtocollo "+registroProtocollo);

String dataOra=responseProtoPartenza.get("data")+" "+responseProtoPartenza.get("ora");
System.out.println("dataOradataOra "+dataOra);// es. 16/02/2021 15:23

java.util.Date initDate = new java.text.SimpleDateFormat("dd/MM/yyyy HH:ss").parse(dataOra);

java.text.DateFormat formatter = new java.text.SimpleDateFormat(formatoDataProtocollo);
formatter.setTimeZone(java.util.TimeZone.getTimeZone(timeZoneDataProtocollo));
dataProtocollo = formatter.format(initDate);

System.out.println("dataProtocollodataProtocollo "+dataProtocollo);

riferimentoProto.registro.codice=registroProtocollo;
riferimentoProto.anno=responseProtoPartenza.get("anno");
riferimentoProto.numero=numeroProtocollo;
System.out.println("riferimentoProtoriferimentoProto "+riferimentoProto);

/**************  end user script  ***************/

//[auto-insert]
//xml_mittenti, xml_destinatari, numeroProtocollo, registroProtocollo, dataProtocollo, riferimentoProto, riferimentoProto
kcontext.setVariable("xml_mittenti",null);
kcontext.setVariable("xml_mittenti",xml_mittenti);
kcontext.setVariable("xml_destinatari",null);
kcontext.setVariable("xml_destinatari",xml_destinatari);
kcontext.setVariable("numeroProtocollo",null);
kcontext.setVariable("numeroProtocollo",numeroProtocollo);
kcontext.setVariable("registroProtocollo",null);
kcontext.setVariable("registroProtocollo",registroProtocollo);
kcontext.setVariable("dataProtocollo",null);
kcontext.setVariable("dataProtocollo",dataProtocollo);
kcontext.setVariable("riferimentoProto",null);
kcontext.setVariable("riferimentoProto",riferimentoProto);
kcontext.setVariable("riferimentoProto",null);
kcontext.setVariable("riferimentoProto",riferimentoProto);



        ]]>
    </script>
</scriptTask>



<sequenceFlow id="con_2111" sourceRef="block28" targetRef="block27">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_2129" sourceRef="block32" targetRef="block25">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_2135" sourceRef="block31" targetRef="block33">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<scriptTask id="block18" scriptFormat="http://www.mvel.org/2.0" name="Prepara medatati aggiornamento destinatario" isForCompensation="false" >
    <script>
        <![CDATA[



/************** start user script ***************/

_tmp1_=new java.util.HashMap();
_tmp1_.put("@structure","document");
_tmp1_.put("TIPO_COMPONENTE",docDaProtocollare.TIPO_COMPONENTE);
_tmp1_.put("DOCNAME",docDaProtocollare.DOCNAME);
_tmp1_.put("TYPE_ID",docDaProtocollare.TYPE_ID);
_tmp1_.put("DOCNUM",docDaProtocollare.DOCNUM);

//metadati custom
_tmp1_.put("DESTINATARI",xml_destinatari);


/**************  end user script  ***************/

//[auto-insert]
//_tmp1_
kcontext.setVariable("_tmp1_",null);
kcontext.setVariable("_tmp1_",_tmp1_);



        ]]>
    </script>
</scriptTask>



<sequenceFlow id="con_2117" sourceRef="block30" targetRef="block16">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<task id="block13" name="Salva protocollo su docer" tns:taskName="DocerJMS" >
    <ioSpecification>

        <dataInput id="block13_TaskNameInput" name="TaskName" />
        <dataInput id="block13_GroupIdInput" name="GroupId" />
        <dataInput id="block13_Operation" name="operation" />

            <dataInput id="block13_tipo_richiestaInput" name="tipo_richiesta" />
            <dataInput id="block13_userTokenInput" name="userToken" />
            <dataInput id="block13_documentInput" name="document" />
            <dataInput id="block13_oggettoInput" name="oggetto" />
            <dataInput id="block13_numero_protocollazioneInput" name="numero_protocollazione" />
            <dataInput id="block13_data_protocollazioneInput" name="data_protocollazione" />
            <dataInput id="block13_registro_protocollazioneInput" name="registro_protocollazione" />
            <dataInput id="block13_tipofirmaInput" name="tipofirma" />
        
            <dataOutput id="block13_userTokenOutput" name="userToken" />
            <dataOutput id="block13_documentOutput" name="document" />
           

        <inputSet>
            <dataInputRefs>block13_TaskNameInput</dataInputRefs>
            <dataInputRefs>block13_GroupIdInput</dataInputRefs>
            <dataInputRefs>block13_Operation</dataInputRefs>
                <dataInputRefs>block13_tipo_richiestaInput</dataInputRefs>
                <dataInputRefs>block13_userTokenInput</dataInputRefs>
                <dataInputRefs>block13_documentInput</dataInputRefs>
                <dataInputRefs>block13_oggettoInput</dataInputRefs>
                <dataInputRefs>block13_numero_protocollazioneInput</dataInputRefs>
                <dataInputRefs>block13_data_protocollazioneInput</dataInputRefs>
                <dataInputRefs>block13_registro_protocollazioneInput</dataInputRefs>
                <dataInputRefs>block13_tipofirmaInput</dataInputRefs>
        </inputSet>
        
        <outputSet>
                <dataOutputRefs>block13_userTokenOutput</dataOutputRefs>
                <dataOutputRefs>block13_documentOutput</dataOutputRefs>
                
         </outputSet>

    </ioSpecification>
                <dataInputAssociation>
                            <sourceRef>tipoRichiesta</sourceRef>
                            <targetRef>block13_tipo_richiestaInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>systemToken</sourceRef>
                            <targetRef>block13_userTokenInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>docDaProtocollare</sourceRef>
                            <targetRef>block13_documentInput</targetRef>

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>oggettoProto</sourceRef>
                            <targetRef>block13_oggettoInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>numeroProtocollo</sourceRef>
                            <targetRef>block13_numero_protocollazioneInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>dataProtocollo</sourceRef>
                            <targetRef>block13_data_protocollazioneInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>registroProtocollo</sourceRef>
                            <targetRef>block13_registro_protocollazioneInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>"NF";</sourceRef>
                            <targetRef>block13_tipofirmaInput</targetRef>
                            

                </dataInputAssociation>

      <dataInputAssociation>
        <targetRef>block13_GroupIdInput</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression"></from>
           <to xsi:type="tFormalExpression">block13_GroupIdInput</to>
        </assignment>
      </dataInputAssociation>
      <dataInputAssociation>
        <targetRef>block13_TaskNameInput</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression">Salva protocollo su docer</from>
           <to xsi:type="tFormalExpression">block13_TaskNameInput</to>
        </assignment>
      </dataInputAssociation>
	  <dataInputAssociation>
        <targetRef>block13_Operation</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression">ProtocollaDocumentoDoc</from>
           <to xsi:type="tFormalExpression">block13_Operation</to>
        </assignment>
      </dataInputAssociation>

            <dataOutputAssociation>
                            <sourceRef>block13_userTokenOutput</sourceRef>
                            <targetRef>systemToken</targetRef>
                            
            </dataOutputAssociation>
            <dataOutputAssociation>
                            <sourceRef>block13_documentOutput</sourceRef>
                            <targetRef>docDaProtocollare</targetRef>
            </dataOutputAssociation>
           
      <potentialOwner>
        <resourceAssignmentExpression>
           <formalExpression></formalExpression>
        </resourceAssignmentExpression>
      </potentialOwner>
</task>

<sequenceFlow id="con_2075" sourceRef="block0" targetRef="block20">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_2033" sourceRef="block10" targetRef="block11">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_2153" sourceRef="block25" targetRef="block12">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_2099" sourceRef="block26" targetRef="block27">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[tipoRichiesta!="U"]]>
    </conditionExpression>
</sequenceFlow>

<task id="block17" name="Update metadata mittenti e destinatari" tns:taskName="DocerJMS" >
    <ioSpecification>

        <dataInput id="block17_TaskNameInput" name="TaskName" />
        <dataInput id="block17_GroupIdInput" name="GroupId" />
        <dataInput id="block17_Operation" name="operation" />

            <dataInput id="block17_userTokenInput" name="userToken" />
            <dataInput id="block17_mittenteInput" name="mittente" />
            <dataInput id="block17_documentInput" name="document" />
            <dataInput id="block17_destinatarioInput" name="destinatario" />
        
            <dataOutput id="block17_userTokenOutput" name="userToken" />
            <dataOutput id="block17_documentOutput" name="document" />
           

        <inputSet>
            <dataInputRefs>block17_TaskNameInput</dataInputRefs>
            <dataInputRefs>block17_GroupIdInput</dataInputRefs>
            <dataInputRefs>block17_Operation</dataInputRefs>
                <dataInputRefs>block17_userTokenInput</dataInputRefs>
                <dataInputRefs>block17_mittenteInput</dataInputRefs>
                <dataInputRefs>block17_documentInput</dataInputRefs>
                <dataInputRefs>block17_destinatarioInput</dataInputRefs>
        </inputSet>
        
        <outputSet>
                <dataOutputRefs>block17_userTokenOutput</dataOutputRefs>
                <dataOutputRefs>block17_documentOutput</dataOutputRefs>
                
         </outputSet>

    </ioSpecification>
                <dataInputAssociation>
                            <sourceRef>systemToken</sourceRef>
                            <targetRef>block17_userTokenInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef></sourceRef>
                            <targetRef>block17_mittenteInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>_tmp1_</sourceRef>
                            <targetRef>block17_documentInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef></sourceRef>
                            <targetRef>block17_destinatarioInput</targetRef>
                            

                </dataInputAssociation>

      <dataInputAssociation>
        <targetRef>block17_GroupIdInput</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression"></from>
           <to xsi:type="tFormalExpression">block17_GroupIdInput</to>
        </assignment>
      </dataInputAssociation>
      <dataInputAssociation>
        <targetRef>block17_TaskNameInput</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression">Update metadata mittenti e destinatari</from>
           <to xsi:type="tFormalExpression">block17_TaskNameInput</to>
        </assignment>
      </dataInputAssociation>
      <dataInputAssociation>
        <targetRef>block17_Operation</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression">AggiornaDocumento</from>
           <to xsi:type="tFormalExpression">block17_Operation</to>
        </assignment>
      </dataInputAssociation>


            <dataOutputAssociation>
                            <sourceRef>block17_userTokenOutput</sourceRef>
                            <targetRef>systemToken</targetRef>
                            
            </dataOutputAssociation>
            <dataOutputAssociation>
                            <sourceRef>block17_documentOutput</sourceRef>
                            <targetRef>docDaProtocollare</targetRef>
            </dataOutputAssociation>
           
      <potentialOwner>
        <resourceAssignmentExpression>
           <formalExpression></formalExpression>
        </resourceAssignmentExpression>
      </potentialOwner>
</task>


<!-- ********************************************************************* -->
<!-- START NEW EXPORT serviceTask -->
<!-- ********************************************************************* -->
<serviceTask id="block32" operationRef="swaggerOperation" isForCompensation="false" name="inserisciPartenza" >
<extensionElements>
        <tns:onExit-script scriptFormat="http://www.mvel.org/2.0" >
            <tns:script><![CDATA[
            
//output declarations
httpStatus=$.?httpStatus; //_tmp0_= httpStatus;
Result=$.?Result; //_tmp1_= Result;
esito=$.?esito; //esitoProtoPartenza= esito;
messaggio=$.?messaggio; //messaggioProtoPartenza= messaggio;
segnatura=$.?segnatura; //responseProtoPartenza= segnatura;

            System.out.println("responseProtoPartenza");
System.out.println(responseProtoPartenza);

            
                ]]></tns:script>
        </tns:onExit-script>
</extensionElements>
<!-- ioSpecification -->
<ioSpecification>
    <dataInput id="block32_documentoInput" name="documento" />
    <dataInput id="block32_confermaSegnaturaInput" name="confermaSegnatura" />
    <dataInput id="block32_protocollaPartenzaInput" name="protocollaPartenza" />
    <dataInput id="block32_BodyInput" name="Body" />
    <dataInput id="block32_usernameInput" name="username" />
    <dataInput id="block32_retryDelayInput" name="retryDelay" />
    <dataInput id="block32_restUrlInput" name="restUrl" />
    <dataInput id="block32_srvTimeoutInput" name="srvTimeout" />
    <dataInput id="block32_acceptedStatusInput" name="acceptedStatus" />
    <dataInput id="block32_nameInput" name="name" />
    <dataInput id="block32_hostInput" name="host" />
    <dataInput id="block32_commitInput" name="commit" />
    <dataInput id="block32_httpMethodInput" name="httpMethod" />
    <dataInput id="block32_contentTypeInput" name="contentType" />
    <dataInput id="block32_callTypeInput" name="callType" />
    <dataInput id="block32_apiDocInput" name="apiDoc" />
    <dataOutput id="block32_segnaturaOutput" name="segnatura" />
    <dataOutput id="block32_esitoOutput" name="esito" />
    <dataOutput id="block32_messaggioOutput" name="messaggio" />
    <dataOutput id="block32_httpStatusOutput" name="httpStatus" />
    <dataOutput id="block32_ResultOutput" name="Result" />

    <inputSet>
        <dataInputRefs>block32_documentoInput</dataInputRefs>
        <dataInputRefs>block32_confermaSegnaturaInput</dataInputRefs>
        <dataInputRefs>block32_protocollaPartenzaInput</dataInputRefs>
        <dataInputRefs>block32_BodyInput</dataInputRefs>
        <dataInputRefs>block32_usernameInput</dataInputRefs>
        <dataInputRefs>block32_retryDelayInput</dataInputRefs>
        <dataInputRefs>block32_restUrlInput</dataInputRefs>
        <dataInputRefs>block32_srvTimeoutInput</dataInputRefs>
        <dataInputRefs>block32_acceptedStatusInput</dataInputRefs>
        <dataInputRefs>block32_nameInput</dataInputRefs>
        <dataInputRefs>block32_hostInput</dataInputRefs>
        <dataInputRefs>block32_commitInput</dataInputRefs>
        <dataInputRefs>block32_httpMethodInput</dataInputRefs>
        <dataInputRefs>block32_contentTypeInput</dataInputRefs>
        <dataInputRefs>block32_callTypeInput</dataInputRefs>
        <dataInputRefs>block32_apiDocInput</dataInputRefs>
    </inputSet>

    <outputSet>
        <dataOutputRefs>block32_segnaturaOutput</dataOutputRefs>
        <dataOutputRefs>block32_esitoOutput</dataOutputRefs>
        <dataOutputRefs>block32_messaggioOutput</dataOutputRefs>
        <dataOutputRefs>block32_httpStatusOutput</dataOutputRefs>
        <dataOutputRefs>block32_ResultOutput</dataOutputRefs>
    </outputSet>
</ioSpecification>

<!-- lista inputs -->
<dataInputAssociation><!-- k:documento var type: objectRef -->
        <sourceRef><![CDATA[documentoPrincipale]]></sourceRef>
        <targetRef>block32_documentoInput</targetRef>
</dataInputAssociation>
<dataInputAssociation><!-- k:confermaSegnatura var type: boolRef -->
        <sourceRef><![CDATA[]]></sourceRef>
        <targetRef>block32_confermaSegnaturaInput</targetRef>
</dataInputAssociation>
<dataInputAssociation><!-- k:protocollaPartenza var type: objectRef -->
        <sourceRef><![CDATA[protocollaPartenza]]></sourceRef>
        <targetRef>block32_protocollaPartenzaInput</targetRef>
</dataInputAssociation>
<dataInputAssociation><!-- k:Body var type: objectRef -->
        <sourceRef><![CDATA[]]></sourceRef>
        <targetRef>block32_BodyInput</targetRef>
</dataInputAssociation>
<dataInputAssociation><!-- k:username var type: textRef -->
        <sourceRef><![CDATA[username]]></sourceRef>
        <targetRef>block32_usernameInput</targetRef>
</dataInputAssociation>

<!-- lista props -->
<dataInputAssociation><!-- var type: string -->
        <targetRef>block32_retryDelayInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[]]></from>
            <to xsi:type="tFormalExpression">block32_retryDelayInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: readOnly -->
        <targetRef>block32_restUrlInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[/jEnte/JProtocolloServices#inserisciPartenza]]></from>
            <to xsi:type="tFormalExpression">block32_restUrlInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: integer -->
        <sourceRef><![CDATA[15000]]></sourceRef>
        <targetRef>block32_srvTimeoutInput</targetRef>
</dataInputAssociation>
<dataInputAssociation><!-- var type: text -->
        <targetRef>block32_acceptedStatusInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[200-299]]></from>
            <to xsi:type="tFormalExpression">block32_acceptedStatusInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: text -->
        <targetRef>block32_nameInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[inserisciPartenza]]></from>
            <to xsi:type="tFormalExpression">block32_nameInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: textRef -->
        <sourceRef><![CDATA[host]]></sourceRef>
        <targetRef>block32_hostInput</targetRef>
</dataInputAssociation>
<dataInputAssociation><!-- var type: boolean -->
        <sourceRef>false</sourceRef>
        <targetRef>block32_commitInput</targetRef>
</dataInputAssociation>
<dataInputAssociation><!-- var type: readOnly -->
        <targetRef>block32_httpMethodInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[post]]></from>
            <to xsi:type="tFormalExpression">block32_httpMethodInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: enum -->
        <targetRef>block32_contentTypeInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[]]></from>
            <to xsi:type="tFormalExpression">block32_contentTypeInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: enum -->
        <targetRef>block32_callTypeInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[delayed]]></from>
            <to xsi:type="tFormalExpression">block32_callTypeInput</to>
        </assignment>
</dataInputAssociation>
<dataInputAssociation><!-- var type: readOnly -->
        <targetRef>block32_apiDocInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression"><![CDATA[{"swagger":"2.0","info":{"title":"JProtocolloServicesService"},"host":"localhost:8082","basePath":"/jEnte/JProtocolloServices","schemes":["http"],"paths":{"#inserisciPartenza":{"post":{"tags":["SOAP","SOAP11"],"summary":"inserisciPartenza","operationId":"","consumes":["text/xml; charset=utf-8"],"parameters":[{"in":"body","required":false,"schema":{"required":["documento","protocollaPartenza","username"],"properties":{"username":{"type":"string","title":"username"},"protocollaPartenza":{"type":"object","title":"protocollaPartenza","properties":{"registro":{"type":"object","title":"registro","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"sezione":{"type":"object","title":"sezione","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"corrispondente":{"type":"object","title":"corrispondente","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"mittenteInterno":{"type":"object","title":"mittenteInterno","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"soggetti":{"type":"array","title":"soggetti","items":{"type":"object","properties":{"soggetto":{"type":"object","title":"soggetto","properties":{"denominazione":{"type":"string","title":"denominazione"},"indirizzo":{"type":"string","title":"indirizzo"}},"required":["denominazione"]},"anagrafica":{"type":"object","title":"anagrafica","properties":{"codice":{"type":"string","title":"codice"},"denominazione":{"type":"string","title":"denominazione"},"indirizzo":{"type":"string","title":"indirizzo"}},"required":["codice"]},"amministrazione":{"type":"object","title":"amministrazione","properties":{"ente":{"type":"object","title":"ente","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"aoo":{"type":"object","title":"aoo","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"},"email":{"type":"string","title":"email"}},"required":["codice"]},"uo":{"type":"object","title":"uo","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"},"email":{"type":"string","title":"email"}},"required":["codice"]}},"required":["aoo","ente","uo"]}},"required":["amministrazione","anagrafica","soggetto"]},"maxItems":-1,"minItems":1},"oggetto":{"type":"string","title":"oggetto"},"smistamenti":{"type":"object","title":"smistamenti","properties":{"corrispondente":{"type":"object","title":"corrispondente","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"nota":{"type":"string","title":"nota"}},"required":["corrispondente"]},"classificazione":{"type":"object","title":"classificazione","properties":{"titolario":{"type":"string","title":"titolario"},"descrizione":{"type":"string","title":"descrizione"},"fascicolo":{"type":"object","title":"fascicolo","properties":{"anno":{"type":"string","title":"anno"},"numero":{"type":"string","title":"numero"},"descrizione":{"type":"string","title":"descrizione"}},"required":["anno","numero"]}},"required":["titolario"]},"dataInvio":{"type":"string","title":"dataInvio"},"estremi":{"type":"object","title":"estremi","properties":{"data":{"type":"string","title":"data"},"numero":{"type":"string","title":"numero"},"importo":{"type":"string","title":"importo"},"allegati":{"type":"string","title":"allegati"}}},"anteatto":{"type":"object","title":"anteatto","properties":{"registro":{"type":"object","title":"registro","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"anno":{"type":"string","title":"anno"},"numero":{"type":"string","title":"numero"}},"required":["anno","numero","registro"]},"altriDati":{"type":"object","title":"altriDati","properties":{"tipoDocumento":{"type":"object","title":"tipoDocumento","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"tramite":{"type":"object","title":"tramite","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"note":{"type":"string","title":"note"},"attributo1":{"type":"string","title":"attributo1"},"attributo2":{"type":"string","title":"attributo2"},"affare":{"type":"object","title":"affare","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"visibilita":{"type":"string","title":"visibilita"}},"required":["affare","tipoDocumento","tramite"]}},"required":["altriDati","anteatto","classificazione","corrispondente","estremi","mittenteInterno","oggetto","registro","sezione","smistamenti","soggetti"]},"documento":{"type":"object","title":"documento","properties":{"titolo":{"type":"string","title":"titolo"},"volume":{"type":"object","title":"volume","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"formato":{"type":"object","title":"formato","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"nomeFile":{"type":"string","title":"nomeFile"},"file":{"type":"string","format":"byte","title":"file"}},"required":["file","nomeFile","titolo"]},"confermaSegnatura":{"type":"boolean","title":"confermaSegnatura"}},"title":"parameters","xml":{"name":"inserisciPartenza/richiesta","namespace":"http://webservices.jprotocollo.jente.infor.arezzo.it/","prefix":"web"},"x-namespaces":"xmlns:soapEnv=http://schemas.xmlsoap.org/soap/envelope/"}}],"responses":{"200":{"schema":{"type":"object","title":"parameters","properties":{"esito":{"type":"string","title":"esito"},"messaggio":{"type":"string","title":"messaggio"},"segnatura":{"type":"object","title":"segnatura","properties":{"registro":{"type":"object","title":"registro","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"sezione":{"type":"object","title":"sezione","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"anno":{"type":"string","title":"anno"},"numero":{"type":"string","title":"numero"},"data":{"type":"string","title":"data"},"ora":{"type":"string","title":"ora"},"amministrazione":{"type":"object","title":"amministrazione","properties":{"ente":{"type":"object","title":"ente","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]},"aoo":{"type":"object","title":"aoo","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"},"email":{"type":"string","title":"email"}},"required":["codice"]},"uo":{"type":"object","title":"uo","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"},"email":{"type":"string","title":"email"}},"required":["codice"]}},"required":["aoo","ente","uo"]},"classificazione":{"type":"object","title":"classificazione","properties":{"titolario":{"type":"string","title":"titolario"},"descrizione":{"type":"string","title":"descrizione"},"fascicolo":{"type":"object","title":"fascicolo","properties":{"anno":{"type":"string","title":"anno"},"numero":{"type":"string","title":"numero"},"descrizione":{"type":"string","title":"descrizione"}},"required":["anno","numero"]}},"required":["titolario"]},"corrispondente":{"type":"object","title":"corrispondente","properties":{"codice":{"type":"string","title":"codice"},"descrizione":{"type":"string","title":"descrizione"}},"required":["codice"]}},"required":["amministrazione","anno","classificazione","corrispondente","data","numero","ora","registro","sezione"]}},"required":["esito","messaggio","segnatura"]}},"500":{"description":"Soap Generic Fault","schema":{"type":"object","properties":{"faultcode":{"type":"string"},"faultstring":{"type":"string"},"faultfactor":{"type":"string"}}}}}}}}}]]></from>
            <to xsi:type="tFormalExpression">block32_apiDocInput</to>
        </assignment>
</dataInputAssociation>

<!-- lista outputs -->
<dataOutputAssociation>
    <sourceRef></sourceRef>
    <targetRef>$</targetRef>
    <transformation language="http://www.java.com/js" >
    var $ = new java.util.HashMap();
	try{ $.put("httpStatus",httpStatus); } catch(e) {};
	try{ $.put("Result",Result); } catch(e) {};
	try{ $.put("esito",esito); } catch(e) {};
	try{ $.put("messaggio",messaggio); } catch(e) {};
	try{ $.put("segnatura",segnatura); } catch(e) {};
	$;
    </transformation>
</dataOutputAssociation>
<dataOutputAssociation>
        <sourceRef>block32_segnaturaOutput</sourceRef>
        <targetRef>responseProtoPartenza</targetRef>
</dataOutputAssociation>
<dataOutputAssociation>
        <sourceRef>block32_esitoOutput</sourceRef>
        <targetRef>esitoProtoPartenza</targetRef>
</dataOutputAssociation>
<dataOutputAssociation>
        <sourceRef>block32_messaggioOutput</sourceRef>
        <targetRef>messaggioProtoPartenza</targetRef>
</dataOutputAssociation>
<dataOutputAssociation>
        <sourceRef>block32_httpStatusOutput</sourceRef>
        <targetRef>_tmp0_</targetRef>
</dataOutputAssociation>
<dataOutputAssociation>
        <sourceRef>block32_ResultOutput</sourceRef>
        <targetRef>_tmp1_</targetRef>
</dataOutputAssociation>
</serviceTask>


<!-- ********************************************************************* -->
<sequenceFlow id="con_2063" sourceRef="block17" targetRef="block1">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<userTask id="block10" name="Old HT_block10" >


    <ioSpecification>

        <dataInput id="block10_TaskNameInput" name="TaskName" />
        <dataInput id="block10_GroupIdInput" name="GroupId" />
        <dataInput id="block10_SwimlaneActorIdInput" name="SwimlaneActorId" />

            <dataInput id="block10_commentInput" name="comment" />
            <dataInput id="block10_messaggioProtoPartenzaInput" name="messaggioProtoPartenza" />
        
            <dataOutput id="block10_reasonOutput" name="reason" />
            <dataOutput id="block10_userTokenOutput" name="userToken" />
           

        <inputSet>
            <dataInputRefs>block10_SwimlaneActorIdInput</dataInputRefs>
            <dataInputRefs>block10_TaskNameInput</dataInputRefs>
            <dataInputRefs>block10_GroupIdInput</dataInputRefs>
                <dataInputRefs>block10_commentInput</dataInputRefs>
                <dataInputRefs>block10_messaggioProtoPartenzaInput</dataInputRefs>
        </inputSet>
        
        <outputSet>
                <dataOutputRefs>block10_reasonOutput</dataOutputRefs>
                <dataOutputRefs>block10_userTokenOutput</dataOutputRefs>
                
         </outputSet>

    </ioSpecification>
                <dataInputAssociation>
                                <targetRef>block10_commentInput</targetRef>
                                <assignment>
                                <from xsi:type="tFormalExpression"><![CDATA[]]></from>
                                <to xsi:type="tFormalExpression">block10_commentInput</to>
                                </assignment>

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>messaggioProtoPartenza</sourceRef>
                            <targetRef>block10_messaggioProtoPartenzaInput</targetRef>
                            

                </dataInputAssociation>

      <dataInputAssociation>
          <sourceRef>UO.identity</sourceRef>
          <targetRef>block10_GroupIdInput</targetRef>
      </dataInputAssociation>
      <dataInputAssociation>
        <targetRef>block10_TaskNameInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression">"Gestione errore di protocollo"</from>
           <to xsi:type="tFormalExpression">block10_TaskNameInput</to>
        </assignment>
      </dataInputAssociation>
            <dataOutputAssociation>
                    <sourceRef>block10_reasonOutput</sourceRef>
                    <targetRef></targetRef>
            </dataOutputAssociation>
            <dataOutputAssociation>
                    <sourceRef>block10_userTokenOutput</sourceRef>
                    <targetRef>humanToken</targetRef>
            </dataOutputAssociation>
           
      <potentialOwner>
        <resourceAssignmentExpression>
           <formalExpression></formalExpression>
        </resourceAssignmentExpression>
      </potentialOwner>
</userTask>

<sequenceFlow id="con_2093" sourceRef="block26" targetRef="block11">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[tipoRichiesta=="U"]]>
    </conditionExpression>
</sequenceFlow>

<sequenceFlow id="con_2105" sourceRef="block12" targetRef="block28">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[esitoProtoPartenza=="OK"]]>
    </conditionExpression>
</sequenceFlow>

<exclusiveGateway id="block26" name="Exclusive Split (XOR)" gatewayDirection="Diverging"></exclusiveGateway>

<sequenceFlow id="con_2069" sourceRef="block20" targetRef="block19">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<scriptTask id="block16" scriptFormat="http://www.mvel.org/2.0" name="Prepara medatati aggiornamento mittente" isForCompensation="false" >
    <script>
        <![CDATA[



/************** start user script ***************/

_tmp1_=new java.util.HashMap();
_tmp1_.put("@structure","document");
_tmp1_.put("TIPO_COMPONENTE",docDaProtocollare.TIPO_COMPONENTE);
_tmp1_.put("DOCNAME",docDaProtocollare.DOCNAME);
_tmp1_.put("TYPE_ID",docDaProtocollare.TYPE_ID);
_tmp1_.put("DOCNUM",docDaProtocollare.DOCNUM);

//metadati custom
_tmp1_.put("MITTENTI",xml_mittenti);


/**************  end user script  ***************/

//[auto-insert]
//_tmp1_
kcontext.setVariable("_tmp1_",null);
kcontext.setVariable("_tmp1_",_tmp1_);



        ]]>
    </script>
</scriptTask>



<task id="block15" name="Update metadata mittenti e destinatari" tns:taskName="DocerJMS" >
    <ioSpecification>

        <dataInput id="block15_TaskNameInput" name="TaskName" />
        <dataInput id="block15_GroupIdInput" name="GroupId" />
        <dataInput id="block15_Operation" name="operation" />

            <dataInput id="block15_userTokenInput" name="userToken" />
            <dataInput id="block15_mittenteInput" name="mittente" />
            <dataInput id="block15_documentInput" name="document" />
            <dataInput id="block15_destinatarioInput" name="destinatario" />
        
            <dataOutput id="block15_userTokenOutput" name="userToken" />
            <dataOutput id="block15_documentOutput" name="document" />
           

        <inputSet>
            <dataInputRefs>block15_TaskNameInput</dataInputRefs>
            <dataInputRefs>block15_GroupIdInput</dataInputRefs>
            <dataInputRefs>block15_Operation</dataInputRefs>
                <dataInputRefs>block15_userTokenInput</dataInputRefs>
                <dataInputRefs>block15_mittenteInput</dataInputRefs>
                <dataInputRefs>block15_documentInput</dataInputRefs>
                <dataInputRefs>block15_destinatarioInput</dataInputRefs>
        </inputSet>
        
        <outputSet>
                <dataOutputRefs>block15_userTokenOutput</dataOutputRefs>
                <dataOutputRefs>block15_documentOutput</dataOutputRefs>
                
         </outputSet>

    </ioSpecification>
                <dataInputAssociation>
                            <sourceRef>systemToken</sourceRef>
                            <targetRef>block15_userTokenInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef></sourceRef>
                            <targetRef>block15_mittenteInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>_tmp1_</sourceRef>
                            <targetRef>block15_documentInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef></sourceRef>
                            <targetRef>block15_destinatarioInput</targetRef>
                            

                </dataInputAssociation>

      <dataInputAssociation>
        <targetRef>block15_GroupIdInput</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression"></from>
           <to xsi:type="tFormalExpression">block15_GroupIdInput</to>
        </assignment>
      </dataInputAssociation>
      <dataInputAssociation>
        <targetRef>block15_TaskNameInput</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression">Update metadata mittenti e destinatari</from>
           <to xsi:type="tFormalExpression">block15_TaskNameInput</to>
        </assignment>
      </dataInputAssociation>
      <dataInputAssociation>
        <targetRef>block15_Operation</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression">AggiornaDocumento</from>
           <to xsi:type="tFormalExpression">block15_Operation</to>
        </assignment>
      </dataInputAssociation>


            <dataOutputAssociation>
                            <sourceRef>block15_userTokenOutput</sourceRef>
                            <targetRef>systemToken</targetRef>
                            
            </dataOutputAssociation>
            <dataOutputAssociation>
                            <sourceRef>block15_documentOutput</sourceRef>
                            <targetRef>docDaProtocollare</targetRef>
            </dataOutputAssociation>
           
      <potentialOwner>
        <resourceAssignmentExpression>
           <formalExpression></formalExpression>
        </resourceAssignmentExpression>
      </potentialOwner>
</task>

<task id="block25" name="Commit" tns:taskName="DocerJMS" >
    <ioSpecification>

        <dataInput id="block25_TaskNameInput" name="TaskName" />
        <dataInput id="block25_Operation" name="operation" />
        <inputSet>
            <dataInputRefs>block25_TaskNameInput</dataInputRefs>
            <dataInputRefs>block25_Operation</dataInputRefs>
        </inputSet>

        <outputSet>

        </outputSet>

    </ioSpecification>
    <dataInputAssociation>
        <targetRef>block25_TaskNameInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression">Commit</from>
            <to xsi:type="tFormalExpression">block25_TaskNameInput</to>
        </assignment>
    </dataInputAssociation>
    <dataInputAssociation>
        <targetRef>block25_Operation</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression">Dummy</from>
            <to xsi:type="tFormalExpression">block25_Operation</to>
        </assignment>
    </dataInputAssociation>

</task>

<exclusiveGateway id="block27" name="Exclusive Join (XOR)" gatewayDirection="Converging"></exclusiveGateway>

<sequenceFlow id="con_2141" sourceRef="block33" targetRef="block30">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<task id="block22" name="Commit" tns:taskName="DocerJMS" >
    <ioSpecification>

        <dataInput id="block22_TaskNameInput" name="TaskName" />
        <dataInput id="block22_Operation" name="operation" />
        <inputSet>
            <dataInputRefs>block22_TaskNameInput</dataInputRefs>
            <dataInputRefs>block22_Operation</dataInputRefs>
        </inputSet>

        <outputSet>

        </outputSet>

    </ioSpecification>
    <dataInputAssociation>
        <targetRef>block22_TaskNameInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression">Commit</from>
            <to xsi:type="tFormalExpression">block22_TaskNameInput</to>
        </assignment>
    </dataInputAssociation>
    <dataInputAssociation>
        <targetRef>block22_Operation</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression">Dummy</from>
            <to xsi:type="tFormalExpression">block22_Operation</to>
        </assignment>
    </dataInputAssociation>

</task>

<task id="block20" name="Recupera profilo doc da protocollare" tns:taskName="DocerJMS" >
    <ioSpecification>

        <dataInput id="block20_TaskNameInput" name="TaskName" />
        <dataInput id="block20_GroupIdInput" name="GroupId" />
        <dataInput id="block20_Operation" name="operation" />
        <dataInput id="block20_ForceDownloadDocument" name="forceDownloadDocument" />

            <dataInput id="block20_userTokenInput" name="userToken" />
            <dataInput id="block20_documentInput" name="document" />
        
            <dataOutput id="block20_userTokenOutput" name="userToken" />
            <dataOutput id="block20_allegatiOutput" name="allegati" />
            <dataOutput id="block20_documentOutput" name="document" />
            <dataOutput id="block20_filePathOutput" name="filePath" />
           

        <inputSet>
            <dataInputRefs>block20_TaskNameInput</dataInputRefs>
            <dataInputRefs>block20_GroupIdInput</dataInputRefs>
            <dataInputRefs>block20_ForceDownloadDocument</dataInputRefs>
            <dataInputRefs>block20_Operation</dataInputRefs>
                <dataInputRefs>block20_userTokenInput</dataInputRefs>
                <dataInputRefs>block20_documentInput</dataInputRefs>
        </inputSet>
        
        <outputSet>
                <dataOutputRefs>block20_userTokenOutput</dataOutputRefs>
                <dataOutputRefs>block20_allegatiOutput</dataOutputRefs>
                <dataOutputRefs>block20_documentOutput</dataOutputRefs>
                <dataOutputRefs>block20_filePathOutput</dataOutputRefs>
                
         </outputSet>

    </ioSpecification>
                <dataInputAssociation>
                            <sourceRef>systemToken</sourceRef>
                            <targetRef>block20_userTokenInput</targetRef>
                            

                </dataInputAssociation>
                <dataInputAssociation>
                            <sourceRef>docDaProtocollare</sourceRef>
                            <targetRef>block20_documentInput</targetRef>

                </dataInputAssociation>
				<dataInputAssociation>
			        <targetRef>block20_ForceDownloadDocument</targetRef>
			        <assignment>
			            <from xsi:type="tFormalExpression">true</from>
			            <to xsi:type="tFormalExpression">block20_ForceDownloadDocument</to>
			        </assignment>
			    </dataInputAssociation>
      <dataInputAssociation>
        <targetRef>block20_GroupIdInput</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression"></from>
           <to xsi:type="tFormalExpression">block20_GroupIdInput</to>
        </assignment>
      </dataInputAssociation>
      <dataInputAssociation>
        <targetRef>block20_TaskNameInput</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression">Recupera profilo doc da protocollare</from>
           <to xsi:type="tFormalExpression">block20_TaskNameInput</to>
        </assignment>
      </dataInputAssociation>
	  <dataInputAssociation>
        <targetRef>block20_Operation</targetRef>
        <assignment>
          <from xsi:type="tFormalExpression">RecuperaProfiloDocumento</from>
           <to xsi:type="tFormalExpression">block20_Operation</to>
        </assignment>
      </dataInputAssociation>

            <dataOutputAssociation>
                            <sourceRef>block20_userTokenOutput</sourceRef>
                            <targetRef>systemToken</targetRef>
                            
            </dataOutputAssociation>
            <dataOutputAssociation>
                            <sourceRef>block20_allegatiOutput</sourceRef>
                            <targetRef></targetRef>
            </dataOutputAssociation>
            <dataOutputAssociation>
                            <sourceRef>block20_documentOutput</sourceRef>
                            <targetRef>docDaProtocollare</targetRef>
            </dataOutputAssociation>
            <dataOutputAssociation>
                            <sourceRef>block20_filePathOutput</sourceRef>
                            <targetRef>pathDocDaProtocollare</targetRef>
                            
            </dataOutputAssociation>
           
      <potentialOwner>
        <resourceAssignmentExpression>
           <formalExpression></formalExpression>
        </resourceAssignmentExpression>
      </potentialOwner>
</task>

<task id="block31" name="Commit" tns:taskName="DocerJMS" >
    <ioSpecification>

        <dataInput id="block31_TaskNameInput" name="TaskName" />
        <dataInput id="block31_Operation" name="operation" />
        <inputSet>
            <dataInputRefs>block31_TaskNameInput</dataInputRefs>
            <dataInputRefs>block31_Operation</dataInputRefs>
        </inputSet>

        <outputSet>

        </outputSet>

    </ioSpecification>
    <dataInputAssociation>
        <targetRef>block31_TaskNameInput</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression">Commit</from>
            <to xsi:type="tFormalExpression">block31_TaskNameInput</to>
        </assignment>
    </dataInputAssociation>
    <dataInputAssociation>
        <targetRef>block31_Operation</targetRef>
        <assignment>
            <from xsi:type="tFormalExpression">Dummy</from>
            <to xsi:type="tFormalExpression">block31_Operation</to>
        </assignment>
    </dataInputAssociation>

</task>

<sequenceFlow id="con_2039" sourceRef="block16" targetRef="block15">
    <conditionExpression language="http://www.mvel.org/2.0" xsi:type="tFormalExpression" >
        <![CDATA[true]]>
    </conditionExpression>
</sequenceFlow>

<!-- id:block0 -->
<startEvent id="block0" name="start (none)" isInterrupting="false" >
    <dataOutput id="block0_Output" name="object" />

    <outputSet>
        <dataOutputRefs>block0_Output</dataOutputRefs>
    </outputSet>

    <dataOutputAssociation>
        <sourceRef>block0_Output</sourceRef>
        <targetRef>_tmpevt_</targetRef>
    </dataOutputAssociation>

</startEvent>

<scriptTask id="block19" scriptFormat="http://www.mvel.org/2.0" name="Gestione documento da inserire in protocollo" isForCompensation="false" >
    <script>
        <![CDATA[



/************** start user script ***************/

String pathUri = String.valueOf(pathDocDaProtocollare);
System.out.println("pathUri "+pathUri);
String characters="getfile/";
String characters2="getFile/";

String newPath = "";
if(pathUri.contains("/getfile/")){
            newPath=pathUri.substring(pathUri.lastIndexOf("/getfile/"),pathUri.length());
            newPath=newPath.replace("/getfile","");
            }
if(pathUri.contains("/getFile/")){
				newPath=pathUri.substring(pathUri.lastIndexOf("/getFile/"),pathUri.length());
            newPath=newPath.replace("/getFile","");
            } 
System.out.println("newPath "+newPath);
java.io.File originalFile = new java.io.File(newPath);
java.io.InputStream fileInputStreamReader = new java.io.FileInputStream(originalFile);

System.out.println("fileInputStreamReaderfileInputStreamReader "+fileInputStreamReader.toString());
//byte[] bytes = new byte[(int)originalFile.length()];
byte[] bytes = org.apache.commons.io.IOUtils.toByteArray(fileInputStreamReader);

System.out.println("encodedBase64");
String encodedBase64 = javax.xml.bind.DatatypeConverter.printBase64Binary(bytes).toString();
System.out.println("encodedBase64encodedBase64 "+encodedBase64);


documentoPrincipale.file=encodedBase64;
documentoPrincipale.nomeFile=docDaProtocollare.DOCNAME;
documentoPrincipale.titolo=docDaProtocollare.DOCNAME;

protocollaPartenza.oggetto=oggettoProto;
protocollaPartenza.soggetti.soggetto.denominazione=destinatario_cittadino.nome+" "+destinatario_cittadino.cognome;

System.out.println("protocollaPartenzaprotocollaPartenza "+protocollaPartenza);

/**************  end user script  ***************/

//[auto-insert]
//documentoPrincipale, documentoPrincipale, documentoPrincipale, protocollaPartenza, destinatario_cittadino
kcontext.setVariable("documentoPrincipale",null);
kcontext.setVariable("documentoPrincipale",documentoPrincipale);
kcontext.setVariable("documentoPrincipale",null);
kcontext.setVariable("documentoPrincipale",documentoPrincipale);
kcontext.setVariable("documentoPrincipale",null);
kcontext.setVariable("documentoPrincipale",documentoPrincipale);
kcontext.setVariable("protocollaPartenza",null);
kcontext.setVariable("protocollaPartenza",protocollaPartenza);
kcontext.setVariable("destinatario_cittadino",null);
kcontext.setVariable("destinatario_cittadino",destinatario_cittadino);



        ]]>
    </script>
</scriptTask>



<exclusiveGateway id="block12" name="Exclusive Split (XOR)" gatewayDirection="Diverging"></exclusiveGateway>



	</process>
</definitions>
